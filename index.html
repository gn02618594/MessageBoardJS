<!DOCTYPE html>

<html>

<head>
	<style>
	</style>
</head>

<body>
	<div>
		<label for="search">搜尋留言:</label>
		<input type="text" id="searchtext">
		<input type="button" id="searchbtn" value="搜尋">
	</div>
	<h1>留言板</h1>
	<div id="newmessagepanel">
		<p>新增留言</p>
		<input type="text" id="message-content" size="40">
		<input type="button" id="message-btn" value="儲存">
	</div>
	<label id="warningmessage" style="color: red;"></label>
	<div>
		<p>顯示留言</p>
		<div id="message-list-container">
		</div>
	</div>
</body>
<script>
	let messageList = [];
	let messageDetailIndex = 0;
	let editMessageInfo=null;
	const messageContentInput = document.querySelector('#message-content');
	const messageBtn = document.querySelector('#message-btn');
	const messageListContainer = document.querySelector('#message-list-container');
	let sVal = null;
	let warnmessage = null;
	function clear() {
		editMessageInfo=null;
		messageContentInput.value='';
		while (messageListContainer.firstChild) {
			messageListContainer.removeChild(messageListContainer.firstChild);
		}
		domchange();
	}

	function render(){
		clear();
		messageList.forEach((messageInfo) => {
			const oUl = document.createElement('div');
			oUl.id = item.MessageId;
			messageListContainer.appendChild(oUl);
			const dBtnDelete = document.createElement('button');
			dBtnDelete.textContent = '刪除';
			dBtnDelete.id = item.Deleteid;
			const dBtnEdit = document.createElement('button');
			dBtnEdit.textContent = '編輯';
			dBtnEdit.id = item.Editid;
			dBtnEdit.addEventListener('click', () => {
				const messagepanel = document.querySelector('#newmessagepanel');
				while (messagepanel.firstChild) {
					messagepanel.removeChild(messagepanel.firstChild);
				}
				const editmsgp = document.createElement('p');
				editmsgp.textContent = '編輯留言';
				const editmsgtext = document.createElement('input');
				editmsgtext.type = 'text';
				editmsgtext.size = '40';
				editmsgtext.id = 'texteditmsg';
				editmsgtext.value = dBtnEdit.parentNode.querySelector('a').text;
				const editcancelbutton = document.createElement('button');
				editcancelbutton.textContent = '取消編輯';
				editcancelbutton.id = 'btneditcancel';
				editcancelbutton.addEventListener('click', () => {
					while (messagepanel.firstChild) {
						messagepanel.removeChild(messagepanel.firstChild);
					}
					const newmsgp = document.createElement('p');
					newmsgp.textContent = '新增留言';
					const newmsgtext = document.createElement('input');
					newmsgtext.type = 'text';
					newmsgtext.size = '40';
					newmsgtext.id = 'message-content';
					const newmsgbtn = document.createElement('input');
					newmsgbtn.type = 'button';
					newmsgbtn.value = '儲存';
					newmsgbtn.id = 'message-btn';
					newmsgbtn.addEventListener('click', save);
					messagepanel.appendChild(newmsgp);
					messagepanel.appendChild(newmsgtext);
					messagepanel.appendChild(newmsgbtn);
					messagepanel.appendChild(newmsgbtn);
				})
				const editsavebutton = document.createElement('input');
				editsavebutton.type = 'button';
				editsavebutton.value = '儲存';
				editsavebutton.id = 'message-btn';
				editsavebutton.addEventListener('click',() =>{
					let editmessageList=messageList.filter((n) => n.Editid=== dBtnEdit.id);
					editmessageList[0].Message=editmsgtext.value;
					removedom();
					while (messagepanel.firstChild) {
						messagepanel.removeChild(messagepanel.firstChild);
					}
					const newmsgp = document.createElement('p');
					newmsgp.textContent = '新增留言';
					const newmsgtext = document.createElement('input');
					newmsgtext.type = 'text';
					newmsgtext.size = '40';
					newmsgtext.id = 'message-content';
					const newmsgbtn = document.createElement('input');
					newmsgbtn.type = 'button';
					newmsgbtn.value = '儲存';
					newmsgbtn.id = 'message-btn';
					newmsgbtn.addEventListener('click', save);
					messagepanel.appendChild(newmsgp);
					messagepanel.appendChild(newmsgtext);
					messagepanel.appendChild(newmsgbtn);
				})
				messagepanel.appendChild(editmsgp);
				messagepanel.appendChild(editmsgtext);
				messagepanel.appendChild(editcancelbutton);
				messagepanel.appendChild(editsavebutton);
				/*test = messageList.filter(tests => tests.no == dBtnEdit.id.substr(4))
				removedom(messageListContainer);*/
			})
			dBtnDelete.addEventListener('click', () => {
				messageList = messageList.filter((n) => n.Deleteid !== dBtnDelete.id);
				removedom();
			})
			const content = document.createElement('a');
			content.textContent = item.Message;
			oUl.appendChild(content);
			oUl.appendChild(dBtnDelete);
			oUl.appendChild(dBtnEdit);
		})
	}
	function save() {	
		sVal = messageContentInput.value;
		warnmessage = document.querySelector('#warningmessage');
		if (sVal == '') {
			warnmessage.innerText = '請輸入內容';
			return;
		}
		warnmessage.textContent = '';
		arraychane();
		removedom();
		messageDetailIndex++;
		messageContentInput.value = '';
	}
	function arraychane() {
		const messageInfo = {
			no: messageDetailIndex,
			name: 'test',
			Message: sVal,
			MessageId: 'Message' + messageDetailIndex,
			Deleteid: 'Delete' + messageDetailIndex,
			Editid: 'Edit' + messageDetailIndex
		}
		messageList.push(messageInfo);
	}
	function domchange() {
		messageList.forEach((item) => {
			
		});
	}

	function searchmessage() {
		const searchtext = document.querySelector('#searchtext');
		const searchmessageList=messageList.filter((n) => n.Message=searchtext.textContent);
		if(searchmessageList.length>0)
		{
			while (messageListContainer.firstChild) {
			messageListContainer.removeChild(messageListContainer.firstChild);
			searchmessageList.forEach((item) => {
				
			})
		}
		}
	}
	document.querySelector('#message-btn').addEventListener('click', save);
	document.querySelector('#searchbtn').addEventListener('click', searchmessage);
	debugger;		
</script>

</html>