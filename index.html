<!DOCTYPE html>

<html>

<head>
	<style>
	</style>
</head>

<body>
	<div>
		<label for="search">搜尋留言:</label>
		<input type="text" id="searchtext">
		<input type="button" id="searchbtn" value="搜尋">
	</div>
	<h1>留言板</h1>
	<div id="newmessagepanel">
		<p>新增留言</p>
		<input type="text" id="message-content" size="40">
		<button id="message-cancel-edit-btn" style="display:none;">取消編輯</button>
		<input type="button" id="message-btn" value="儲存">
	</div>
	<label id="warningmessage" style="color: red;"></label>
	<div>
		<p>顯示留言</p>
		<div id="message-list-container">
		</div>
	</div>
</body>
<script>
	let messageList = [];
	let messageDetailIndex = 0;
	const messageContentInput = document.querySelector('#message-content');
	const messageBtn = document.querySelector('#message-btn');
	const messageListContainer = document.querySelector('#message-list-container');
	const messageCancelEditBtn = document.querySelector('#message-cancel-edit-btn');
	let warnmessage = null;

	function clear() {
		editMessageInfo = null;
		messageCancelEditBtn.style.display = 'none';
		messageContentInput.value = '';

		while (messageListContainer.firstChild) {
			messageListContainer.removeChild(messageListContainer.firstChild);
		}
	}

	function render() {
		clear();
		messageList.forEach((messageInfo) => {
			const content = document.createElement('span');
			content.textContent = messageInfo.content;

			const dBtnEdit = document.createElement('button');
			dBtnEdit.textContent = '編輯';
			dBtnEdit.addEventListener('click',
				() => {
					setEditMessageInfo(messageInfo);
				});

			const dBtnDelete = document.createElement('button');
			dBtnDelete.textContent = '刪除';
			dBtnDelete.addEventListener('click',
				() => {
					deleteMessage(messageInfo.id);
				})

			const div = document.createElement('div');
			div.appendChild(content);
			div.appendChild(dBtnEdit);
			div.appendChild(dBtnDelete);

			messageListContainer.appendChild(div);
		});
	}
	function init() {
		render();
	}
	init();

	function addMessage(value = '') {
		messageList = [
			...messageList, {
				id: messageDetailIndex,
				content: value,
			},
		];
		messageDetailIndex = messageDetailIndex + 1;
		render();
	}
	//還沒看懂
	function editMessage(id, value = '') {
		messageList = messageList.map((messageInfo) => {
			if (messageInfo.id === id) {
				return {
					id: id,
					content: value,
				};
			}
			return messageInfo;
		});
		render();
	}
	function setEditMessageInfo(messageInfo) {
		editMessageInfo = messageInfo;
		messageCancelEditBtn.style.display = 'table-row';

		messageContentInput.value = editMessageInfo.content;
	}
	function setMessage(value = '') {
		if (editMessageInfo) {
			editMessage(editMessageInfo.id, value);
		} else {
			addMessage(value);
		}
	}
	function deleteMessage(id) {
		messageList = messageList.filter((messageInfo) => messageInfo.id !== id);
		render();
	}

	messageBtn.addEventListener('click', () => {
		const contentValue = messageContentInput.value;

		setMessage(contentValue);
	})

	messageCancelEditBtn.addEventListener('click', () => {
		render();
	})
	function save() {
		sVal = messageContentInput.value;
		warnmessage = document.querySelector('#warningmessage');
		if (sVal == '') {
			warnmessage.innerText = '請輸入內容';
			return;
		}
		warnmessage.textContent = '';
		arraychane();
		removedom();
		messageDetailIndex++;
		messageContentInput.value = '';
	}
	function searchmessage() {
		const searchtext = document.querySelector('#searchtext');
		const searchmessageList = messageList.filter((n) => n.Message = searchtext.textContent);
		if (searchmessageList.length > 0) {
			while (messageListContainer.firstChild) {
				messageListContainer.removeChild(messageListContainer.firstChild);
				searchmessageList.forEach((item) => {

				})
			}
		}
	}
	document.querySelector('#searchbtn').addEventListener('click', searchmessage);
	debugger;		
</script>

</html>