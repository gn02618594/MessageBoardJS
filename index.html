<!DOCTYPE html>

<html>

<head>
	<style>
	</style>
</head>

<body>
	<div>
		<label for="search-input">搜尋留言:</label>
		<input type="text" id="search-input">
		<input type="button" id="search-btn" value="搜尋">
	</div>
	<h1>留言板</h1>

	<p>留言區</p>

	<div>
		<input type="text" id="message-title-input">
		<input type="text" id="message-content-input">

		<button id="message-btn">送出</button>

		<button id="message-cancel=edit-btn" style="display: none;">取消編輯</button>
	</div>
	<div>
		<p>顯示留言</p>
		<div id="message-list-container"></div>
	</div>
</body>
<script>
	let messageList = [{
		id: 1, title: '標題', content: '內文',
	}, {
		id: 2, title: '標題2', content: '內文2'
	}
	];

	let editMessageInfo = null;

	const messageTitleInput = document.querySelector('#message-title-input');
	const messageContentInput = document.querySelector('#message-content-input');
	const messageBtn = document.querySelector('#message-btn');
	const messageCancelEditBtn = document.querySelector('#message-cancel-edit-btn');
	const messageListContainer = document.querySelector('#message-list-container');

	function clear() {
		editMessageInfo = null;
		messageCancelEditBtn.style.display = 'none';
		messageTitleInput.value = '';
		messageContentInput.value = '';

		while (messageListContainer.firstChild) {
			messageListContainer.removeChild(messageListContainer.firstChild);

		}
	}
	function render() {
		clear();
		messageList.forEach((messageInfo) => {
			const title = document.createElement('span');
			title.textContent = messageInfo.title;
			const content = document.createElement('span');
			content.textContent = messageInfo.content;

			const editButton = document.createElement('button');
			editButton.textContent = '編輯';
			editButton.addEventListener('click',
				() => {
					setEditMessageInfo(messageInfo);
				});

			const deletelButton = document.createElement('button');
			deletelButton.textContent = '刪除';

			deletelButton.addEventListener('click',
				() => {
					deleteMessage(messageInfo.id);
				});

			const div = document.createElement('div');
			div.appendChild(title);
			div.appendChild(content);
			div.appendChild(editButton);
			div.appendChild(deletelButton);

			messageListContainer.appendChild(div);
		});
	}
	function inti() {
		render();
	}

	init();

	function addMessage(title = '', value = '') {
		messageList = [
			...messageList,
			{
				id: new Date().getTime(),
				title,
				content: value,
			},
		];
		render();
	}
	function editMessage(id, title = '', value = '') {
		messageList = messageList.map((messageInfo) => {
			if (messageInfo.id === id) {
				return {
					id: new Date().getTime(),
					title,
					content: value,
				};
			}
			return messageInfo;
		});
		render();
	}
	function setEditMessageInfo(messageInfo) {
		editMessageInfo = messageInfo;
		messageCancelEditBtn.style.display = 'block';

		messageTitleInput.value = editMessageInfo.title;
		messageContentInput.value = editMessageInfo.content;

	}
	function setMessage(title = '', value = '') {
		if (editMessageInfo) {
			editMessage(editMessageInfo.id, title, value);
		} else {
			addMessage(title, value);
		}

		render();
	}
	function deleteMessage(id) {
		messageList = messageList.filter((messageInfo) => messageInfo.id !== id);

		render();
	}

	messageBtn.addEventListener('click', () => {
		const titleValue = messageTitleInput.value;
		const contentValue = messageContentInput.value;

		setMessage(titleValue, contentValue);
	});

	messageCancelEditBtn.addEventListener('click', () => {
		render();
	});
</script>

</html>